<h1>Welcome to 8book</h1>

<h2>feed</h2>

<section style="border:solid 5px purple">
  <h2>Create post</h2>

  <%= form_for :post, url: posts_path do |f| %>
    <p>
      <%= f.label :message %> <br>
      <%= f.text_area :message, required: true%>
      <%= f.file_field :avatar %>
    </p>

    <p>
      <%= f.submit %>
    </p>

    <% end %>
</section>

<% @posts.each do |post| %>
  <section style="border:solid 1px red">
    <h5><%= get_time_ago(post.created_at) %> ago</h5>
    <div></div>
    <h3><%= post.message %></h3>
    <h3><%= image_tag (post.avatar) if post.avatar.attached? %></h3>

    <%= render partial: "posts/like", locals: { post: post } %>

  <p>Likes: <%= post.likes_count %></p>
  
  <%= link_to "Edit", edit_post_path(post.id), class:"editpost" %>

  <div>
    <h4>Comments</h4>
      <% @comments = Comment.where({post_id: post.id})
      @comments.each do |comment_object| %>
        
        comment: <%= comment_object['comment'] %> 
        user_id: <%= comment_object.user_id %><br />
      
      <% end %>

      <section style="border:solid 5px pink">
      <h2>Add comment</h2>
      <%= form_for :comment, url: comments_path do |f| %>
        <p>
          <%= f.label :comment %> <br>
          <%= f.text_area :comment, required: true, maxlength:500 %><br>
          <%= f.hidden_field :post_id, required: true, value:"#{post.id}" %> 
          <%= f.hidden_field :user_id, required: true, value:"#{session[:user_id]}" %> 
        </p>
        <p>
          <%= f.submit %>
        </p>
      <% end %>
      </section>
    </div>
  </section>
<% end %>

<%== pagy_nav(@pagy) %>
